# DES-1499 Official Cosmology Sample Configuration
# ================================================
#
# Dataset: Dark Energy Survey Year 5 Supernova Cosmology Sample
# Reference: DES Collaboration (2024)
# URL: https://www.darkenergysurvey.org/des-year-3-supernova-cosmology-results/
# Sample Size: 1,499 spectroscopically confirmed Type Ia SNe
# Redshift Range: 0.1 < z < 2.5

dataset:
  name: "des1499"
  version: "Y5R1"
  source_url: "https://www.darkenergysurvey.org/des-year-3-supernova-cosmology-results/"
  manifest_file: "data/raw/des/des1499_manifest.csv"
  lightcurve_file: "data/processed/des1499_lightcurves.csv"

# Quality Control Gates
# Based on V21 analysis: chi2 < 2000, |ln_A| < 20 filtered 1,529/8,253 poor fits
# For DES-1499, we expect ~15-20% rejection rate
quality_gates:
  enabled: true
  chi2_max: 2000.0          # Maximum reduced chi-squared
  ln_A_min: -20.0           # Minimum ln(amplitude)
  ln_A_max: 20.0            # Maximum ln(amplitude)
  stretch_min: 0.5          # Minimum stretch parameter
  stretch_max: 10.0         # Maximum stretch parameter
  min_epochs: 5             # Minimum number of photometric epochs
  max_rejection_rate: 0.30  # Fail if >30% rejected (data quality issue)

# Stage 1: Per-SN Fitting
stage1:
  # Parallelization
  parallel: true
  n_cores: -1               # -1 = use all available cores

  # Fitting parameters
  max_iterations: 1000
  tolerance: 1.0e-6

  # Initial guesses
  ln_A_init: 0.0
  stretch_init: 1.0

  # Output
  output_dir: "results/{run_id}/stage1"
  save_individual_fits: true

# Stage 2: Global MCMC Parameter Fitting
stage2:
  # MCMC configuration
  n_walkers: 32
  n_steps: 4000
  n_burn: 1000
  n_cores: 8

  # Priors (based on V21 successful results)
  # k_J_correction: Gaussian centered at +51, width 20
  # eta_prime: Gaussian centered at -3, width 5
  # xi: Gaussian centered at -6, width 3
  # sigma_ln_A: Uniform [0.1, 3.0]
  priors:
    k_J_correction:
      type: "normal"
      mean: 51.0
      std: 20.0
    eta_prime:
      type: "normal"
      mean: -3.0
      std: 5.0
    xi:
      type: "normal"
      mean: -6.0
      std: 3.0
    sigma_ln_A:
      type: "uniform"
      min: 0.1
      max: 3.0

  # Lean 4 constraint validation
  enforce_lean_constraints: true

  # Output
  output_dir: "results/{run_id}/stage2"
  save_chains: true
  thin_by: 10               # Save every 10th sample to reduce file size

# Stage 3: Hubble Diagram and Model Comparison
stage3:
  # QFD model parameters
  k_J_baseline: 70.0        # Baseline Hubble parameter (km/s/Mpc)

  # ΛCDM comparison
  fit_lcdm: true            # Fit best-fit ΛCDM on same data
  lcdm_omega_m_init: 0.3    # Initial guess for Ωm

  # Residual analysis
  compute_trends: true
  compute_robust_stats: true

  # Output
  output_dir: "results/{run_id}/stage3"
  save_hubble_data: true

# Lean 4 Formal Constraint Validation
lean_validation:
  enabled: true
  schema_version: "V2.0"

  # Constraint ranges (from Lean proofs)
  constraints:
    k_J_total:
      min: 50.0
      max: 150.0
      source: "Lean4_Schema/Proofs/AdjointStability_Complete.lean"
    eta_prime:
      min: -10.0
      max: 0.0
      source: "Lean4_Schema/Proofs/PhysicalScattering.lean"
    xi:
      min: -10.0
      max: 0.0
      source: "Lean4_Schema/Proofs/PhysicalScattering.lean"
    sigma_ln_A:
      min: 0.0
      max: 5.0
      source: "Phenomenological"

  output_dir: "results/{run_id}/validation"

# Visualization
plotting:
  dpi: 150
  figsize: [12, 8]
  style: "seaborn-v0_8-darkgrid"

  # Hubble diagram
  hubble_plot:
    z_min: 0.01
    z_max: 2.5
    show_lcdm: true
    show_residuals: true

  # Corner plot
  corner_plot:
    show_lean_ranges: true
    quantiles: [0.16, 0.5, 0.84]

  output_dir: "results/{run_id}/figures"

# Reporting
reporting:
  generate_summary_json: true
  generate_qc_report: true
  generate_validation_report: true
  generate_pdf_report: false  # Requires LaTeX

  output_dir: "results/{run_id}"

# Reproducibility
reproducibility:
  random_seed: 42
  save_git_hash: true
  save_environment: true
  save_config_copy: true

# Logging
logging:
  level: "INFO"             # DEBUG, INFO, WARNING, ERROR
  to_file: true
  log_file: "results/{run_id}/pipeline.log"
